<!DOCTYPE html>
<html>
<head>
    <title>BMI 결과 및 병원 위치 지도</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        #map { height: 400px; }
    </style>
</head>
<body>
    <h1>BMI 결과</h1>
    <p>당신의 BMI는 {{ bmi }}입니다.</p>
    <p>입력한 위치: {{ location }}</p>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([37.5665, 126.9780], 13); // 초기 위치 설정, 서울을 중심으로 임시 설정

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        var geocodeUrl = "https://nominatim.openstreetmap.org/search?format=json&limit=1&q={{ location }}";
        var hospitalUrl = "https://nominatim.openstreetmap.org/search?format=json&limit=5&amenity=hospital&radius=10000&q={{ location }}";

        fetch(geocodeUrl)
            .then(response => response.json())
            .then(data => {
                var lat = data[0].lat;
                var lon = data[0].lon;
                var locationMarker = L.marker([lat, lon]).addTo(map);
                map.setView([lat, lon], 13);

                fetch(hospitalUrl)
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(hospital => {
                            var hospLat = hospital.lat;
                            var hospLon = hospital.lon;
                            L.marker([hospLat, hospLon]).addTo(map)
                                .bindPopup('병원').openPopup();
                        });
                    })
                    .catch(error => {
                        console.log("병원을 찾을 수 없습니다.", error);
                    });
            })
            .catch(error => {
                console.log("위치를 찾을 수 없습니다.", error);
            });
    </script>
</body>
</html>
